Here's the updated `plan.txt` based on your new Gemini 2.0 Flash integration:

### `plan.txt` â€“ Project Plan â€“ RACE Resume Enhancer

ğŸ“ **Folder Structure**

```
race/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app.js
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ resume.js
â”‚   â”‚   â””â”€â”€ chat.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”œâ”€â”€ resumeController.js
â”‚   â”‚   â””â”€â”€ chatController.js
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”œâ”€â”€ Resume.js
â”‚   â”‚   â””â”€â”€ Chat.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ gemini.js
â”‚   â”‚   â””â”€â”€ extract.js
â”œâ”€â”€ frontend/
```

â¸»

### ğŸ” **Authentication (JWT)**

- **Routes**:  
  - `/register`: Hash passwords and save the user data to DB.  
  - `/login`: Verify the password and issue a JWT.  

- **Error Handling**:  
  - Catch errors for missing fields in `/register` or `/login`.  
  - Return proper error codes (e.g., 400 for invalid inputs, 401 for invalid login).  
  - Handle invalid JWT in the middleware (401 Unauthorized).

---

### ğŸ’¬ **Backend API Routes**

| Method | Endpoint      | Description                                           |
|--------|---------------|-------------------------------------------------------|
| POST   | /upload       | Upload resume file and extract its content            |
| POST   | /enhance      | Enhance the resume with Gemini 2.0 Flash and save as LaTeX format |
| POST   | /register     | Register a new user                                  |
| POST   | /login        | Log in an existing user and issue JWT                |
| POST   | /chat         | Send a user message, get a reply from Gemini 2.0 Flash, and save |
| GET    | /chat/:resumeId | Fetch chat history for the given resume               |

---

### ğŸ§  **Models**

- **User**  
  `{ _id, email, passwordHash }`

- **Resume**  
  `{ _id, userId, originalText, createdAt }`

- **Chat**  
  `{ _id, userId, resumeId, messages: [{ role: 'user' | 'bot', msg: String }], createdAt, updatedAt }`

---

### ğŸ¤– **Gemini 2.0 Flash Integration**

- **API**:  
  - Use Gemini 2.0 Flash for resume enhancement and chat replies.  
  - Return both the enhanced resume (LaTeX) and chat history.

- **Error Handling**:  
  - Handle API errors, such as invalid API keys or rate-limiting.  
  - Log errors in `console.log()` for debugging.

---

### ğŸ§ª **Error Handling Logic**

- **Global Error Handler**  
  - Add a global error handler middleware to catch unexpected errors and return a 500 status code with a user-friendly message.  
  - Wrap all async route logic in try-catch blocks.

- **Specific Error Handlers**:  
  - File upload: Handle file size/type validation.  
  - Resume extraction: Handle errors in file parsing or empty data.  
  - Gemini 2.0 Flash: Handle API errors such as rate limiting or invalid inputs.

---

### ğŸ§¼ **Final Polish**

- **Input Validation**:  
  - Use a library like `joi` or `zod` to validate incoming request bodies.  
  - Check for valid email format, file types, and chat inputs.

- **Logging**:  
  - Log successful and failed requests for better debugging.  
  - Log Gemini responses to verify outputs.

---
